<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#4CAF50">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="application-name" content="Zakat Calculator">
    <meta name="apple-mobile-web-app-title" content="Zakat Calculator">
    <meta name="msapplication-TileColor" content="#4CAF50">
    <meta name="description" content="Calculate your Zakat easily with our modern calculator">
    
    <title>Zakat Calculator</title>
    
    <!-- PWA Icons -->
    <link rel="icon" type="image/png" sizes="32x32" href="https://raw.githubusercontent.com/zub165/zakatcalculator/main/icons/icon-32.png">
    <link rel="apple-touch-icon" sizes="180x180" href="https://raw.githubusercontent.com/zub165/zakatcalculator/main/icons/icon-180.png">
    
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    
    <style>
        :root {
            /* Default Theme (Green) */
            --primary-color: #4CAF50;
            --primary-light: #81C784;
            --primary-dark: #388E3C;
            --secondary-color: #C8E6C9;
            --background-color: #f8f9fa;
            --card-bg: #ffffff;
            --text-color: #2c3e50;
            --border-color: #e0e0e0;
            --shadow-color: rgba(0, 0, 0, 0.1);
            --hover-color: #E8F5E9;
        }

        /* Blue Theme */
        [data-theme="blue"] {
            --primary-color: #2196F3;
            --primary-light: #64B5F6;
            --primary-dark: #1976D2;
            --secondary-color: #BBDEFB;
            --background-color: #f8f9fa;
            --card-bg: #ffffff;
            --text-color: #2c3e50;
            --border-color: #e0e0e0;
            --shadow-color: rgba(0, 0, 0, 0.1);
            --hover-color: #E3F2FD;
        }

        /* Purple Theme */
        [data-theme="purple"] {
            --primary-color: #9C27B0;
            --primary-light: #BA68C8;
            --primary-dark: #7B1FA2;
            --secondary-color: #E1BEE7;
            --background-color: #f8f9fa;
            --card-bg: #ffffff;
            --text-color: #2c3e50;
            --border-color: #e0e0e0;
            --shadow-color: rgba(0, 0, 0, 0.1);
            --hover-color: #F3E5F5;
        }

        /* Dark Theme */
        [data-theme="dark"] {
            --primary-color: #66BB6A;
            --primary-light: #81C784;
            --primary-dark: #4CAF50;
            --secondary-color: #1E1E1E;
            --background-color: #121212;
            --card-bg: #1E1E1E;
            --text-color: #FFFFFF;
            --border-color: #333333;
            --shadow-color: rgba(0, 0, 0, 0.3);
            --hover-color: #2C2C2C;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--background-color);
            color: var(--text-color);
            line-height: 1.6;
            transition: all 0.3s ease;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 30px;
            padding: 15px 0;
        }

        .title {
            font-size: 24px;
            font-weight: 600;
            color: var(--primary-color);
        }

        .theme-switcher {
            display: flex;
            gap: 10px;
        }

        .theme-btn {
            padding: 8px 15px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .card-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .category-card {
            background: var(--card-bg);
            border-radius: 16px;
            padding: 20px;
            text-align: center;
            box-shadow: 0 4px 6px var(--shadow-color);
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }

        .category-card:hover {
            transform: translateY(-5px);
            border-color: var(--primary-color);
            background: var(--hover-color);
        }

        .category-icon {
            width: 48px;
            height: 48px;
            margin-bottom: 12px;
            color: var(--primary-color);
            font-size: 24px;
        }

        .category-name {
            font-size: 16px;
            font-weight: 500;
            margin-bottom: 8px;
        }

        .category-value {
            font-size: 14px;
            color: var(--primary-color);
            font-weight: 600;
            padding: 4px 12px;
            background: var(--secondary-color);
            border-radius: 20px;
            display: inline-block;
        }

        .input-section {
            background: var(--card-bg);
            border-radius: 16px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 4px 6px var(--shadow-color);
        }

        .input-group {
            margin-bottom: 20px;
        }

        .input-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--text-color);
        }

        .input-group input,
        .input-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid var(--border-color);
            border-radius: 8px;
            font-size: 16px;
            background: var(--card-bg);
            color: var(--text-color);
            transition: all 0.3s ease;
        }

        .input-group input:focus,
        .input-group select:focus {
            outline: none;
            border-color: var(--primary-color);
        }

        .rates-card {
            background: var(--card-bg);
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 4px 6px var(--shadow-color);
        }

        .rate-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid var(--border-color);
        }

        .rate-item:last-child {
            border-bottom: none;
        }

        .rate-label {
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .rate-value {
            color: var(--primary-color);
            font-weight: 600;
        }

        .calculate-btn {
            background: var(--primary-color);
            color: white;
            border: none;
            padding: 15px 30px;
            width: 100%;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 20px;
        }

        .calculate-btn:hover {
            background: var(--primary-dark);
            transform: translateY(-2px);
        }

        .result-card {
            background: var(--card-bg);
            border-radius: 16px;
            padding: 25px;
            margin-top: 30px;
            box-shadow: 0 4px 6px var(--shadow-color);
        }

        .result-header {
            text-align: center;
            margin-bottom: 25px;
        }

        .total-zakat {
            font-size: 36px;
            font-weight: 600;
            color: var(--primary-color);
            margin: 15px 0;
        }

        .breakdown-item {
            display: flex;
            justify-content: space-between;
            padding: 12px 0;
            border-bottom: 1px solid var(--border-color);
        }

        .breakdown-label {
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .breakdown-value {
            font-weight: 600;
            color: var(--primary-color);
        }

        /* Enhanced touch-friendly styles */
        @media (hover: none) {
            .category-card:hover {
                transform: none;
            }
            
            .category-card:active {
                transform: scale(0.98);
                background: var(--hover-color);
            }
            
            .calculate-btn:active {
                transform: scale(0.98);
            }
        }

        /* iOS-specific styles */
        @supports (-webkit-touch-callout: none) {
            input, select, button {
                -webkit-appearance: none;
                appearance: none;
            }
            
            select {
                background-image: url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' fill='%23333'%3E%3Cpath d='M6 9L0 0h12z'/%3E%3C/svg%3E");
                background-repeat: no-repeat;
                background-position: right 8px center;
                padding-right: 24px;
            }
        }

        /* Better mobile responsiveness */
        @media (max-width: 768px) {
            .container {
                padding: 12px;
            }

            .header {
                flex-direction: column;
                gap: 15px;
                text-align: center;
            }

            .theme-switcher {
                justify-content: center;
            }

            .card-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 12px;
            }

            .category-card {
                padding: 15px;
            }

            .input-section, .rates-card {
                padding: 15px;
            }

            .input-group input,
            .input-group select {
                font-size: 16px; /* Prevents iOS zoom */
                padding: 10px;
            }

            .calculate-btn {
                padding: 12px;
                margin-bottom: 20px;
            }
        }

        @media (max-width: 480px) {
            .card-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .theme-btn {
                padding: 6px 10px;
                font-size: 12px;
            }

            .category-icon {
                font-size: 20px;
            }

            .category-name {
                font-size: 14px;
            }

            .category-value {
                font-size: 12px;
                padding: 3px 8px;
            }
        }

        /* Prevent pull-to-refresh on mobile */
        html, body {
            overscroll-behavior-y: contain;
            -webkit-overflow-scrolling: touch;
            position: fixed;
            width: 100%;
            height: 100%;
            overflow-y: auto;
        }

        /* Safe area insets for notched devices */
        @supports (padding: max(0px)) {
            .container {
                padding-left: max(20px, env(safe-area-inset-left));
                padding-right: max(20px, env(safe-area-inset-right));
                padding-bottom: max(20px, env(safe-area-inset-bottom));
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header class="header">
            <h1 class="title">Zakat Calculator</h1>
            <div class="theme-switcher">
                <button class="theme-btn" onclick="setTheme('default')" style="background: #4CAF50; color: white;">Green</button>
                <button class="theme-btn" onclick="setTheme('blue')" style="background: #2196F3; color: white;">Blue</button>
                <button class="theme-btn" onclick="setTheme('purple')" style="background: #9C27B0; color: white;">Purple</button>
                <button class="theme-btn" onclick="setTheme('dark')" style="background: #121212; color: white;">Dark</button>
            </div>
        </header>

        <div class="card-grid">
            <div class="category-card" onclick="showSection('cash')">
                <i class="fas fa-money-bill-wave category-icon"></i>
                <div class="category-name">Money</div>
                <div class="category-value" id="cash-value">0.00</div>
            </div>
            <div class="category-card" onclick="showSection('gold')">
                <i class="fas fa-coins category-icon"></i>
                <div class="category-name">Gold & Silver</div>
                <div class="category-value" id="precious-value">0.00</div>
            </div>
            <div class="category-card" onclick="showSection('business')">
                <i class="fas fa-store category-icon"></i>
                <div class="category-name">Business</div>
                <div class="category-value" id="business-value">0.00</div>
            </div>
            <div class="category-card" onclick="showSection('investments')">
                <i class="fas fa-chart-line category-icon"></i>
                <div class="category-name">Investments</div>
                <div class="category-value" id="investment-value">0.00</div>
            </div>
            <div class="category-card" onclick="showSection('property')">
                <i class="fas fa-home category-icon"></i>
                <div class="category-name">Property</div>
                <div class="category-value" id="property-value">0.00</div>
            </div>
            <div class="category-card" onclick="showSection('other')">
                <i class="fas fa-plus category-icon"></i>
                <div class="category-name">Other Assets</div>
                <div class="category-value" id="other-value">0.00</div>
            </div>
        </div>

        <div class="input-section">
            <div class="input-group">
                <label>Select Currency:</label>
                <select id="currency" onchange="fetchGoldSilverRates()">
                    <option value="USD">USD ($) - US Dollar</option>
                    <option value="AED">AED (د.إ) - UAE Dirham</option>
                    <option value="AUD">AUD ($) - Australian Dollar</option>
                    <option value="BDT">BDT (৳) - Bangladeshi Taka</option>
                    <option value="BHD">BHD (.د.ب) - Bahraini Dinar</option>
                    <option value="CAD">CAD ($) - Canadian Dollar</option>
                    <option value="CHF">CHF (Fr) - Swiss Franc</option>
                    <option value="CNY">CNY (¥) - Chinese Yuan</option>
                    <option value="EGP">EGP (£) - Egyptian Pound</option>
                    <option value="EUR">EUR (€) - Euro</option>
                    <option value="GBP">GBP (£) - British Pound</option>
                    <option value="IDR">IDR (Rp) - Indonesian Rupiah</option>
                    <option value="INR">INR (₹) - Indian Rupee</option>
                    <option value="JOD">JOD (د.ا) - Jordanian Dinar</option>
                    <option value="JPY">JPY (¥) - Japanese Yen</option>
                    <option value="KWD">KWD (د.ك) - Kuwaiti Dinar</option>
                    <option value="LKR">LKR (₨) - Sri Lankan Rupee</option>
                    <option value="MAD">MAD (د.م.) - Moroccan Dirham</option>
                    <option value="MYR">MYR (RM) - Malaysian Ringgit</option>
                    <option value="NGN">NGN (₦) - Nigerian Naira</option>
                    <option value="OMR">OMR (ر.ع.) - Omani Rial</option>
                    <option value="PKR">PKR (₨) - Pakistani Rupee</option>
                    <option value="QAR">QAR (ر.ق) - Qatari Riyal</option>
                    <option value="SAR">SAR (ر.س) - Saudi Riyal</option>
                    <option value="SGD">SGD ($) - Singapore Dollar</option>
                    <option value="TRY">TRY (₺) - Turkish Lira</option>
                    <option value="ZAR">ZAR (R) - South African Rand</option>
                </select>
            </div>

            <div class="input-group">
                <label>Select Nisab Standard:</label>
                <select id="nisabStandard">
                    <option value="gold">Gold Standard (85g)</option>
                    <option value="silver" selected>Silver Standard (595g) - Recommended</option>
                </select>
            </div>
        </div>

        <div class="rates-card">
            <div class="rate-item">
                <span class="rate-label"><i class="fas fa-coins"></i> Gold Rate</span>
                <span id="goldRate" class="rate-value">Fetching...</span>
            </div>
            <div class="rate-item">
                <span class="rate-label"><i class="fas fa-coins"></i> Silver Rate</span>
                <span id="silverRate" class="rate-value">Fetching...</span>
            </div>
        </div>

        <div id="sections">
            <!-- Cash Section -->
            <div id="cash-section" class="input-group">
                <label>Cash & Bank Balance:</label>
                <input type="number" id="cash" placeholder="Enter amount" min="0">
            </div>

            <!-- Gold & Silver Section -->
            <div id="gold-section" class="input-group">
                <label>Gold Weight:</label>
                <input type="number" id="goldWeight" placeholder="Enter weight" min="0">
                <select id="goldUnit">
                    <option value="grams">Grams</option>
                    <option value="tola">Tolas</option>
                    <option value="oz">Ounces</option>
                    <option value="lbs">Pounds</option>
                </select>

                <label>Silver Weight:</label>
                <input type="number" id="silverWeight" placeholder="Enter weight" min="0">
                <select id="silverUnit">
                    <option value="grams">Grams</option>
                    <option value="tola">Tolas</option>
                    <option value="oz">Ounces</option>
                    <option value="lbs">Pounds</option>
                </select>
            </div>

            <!-- Business Assets Section -->
            <div id="business-section" class="input-group">
                <label>Business Inventory Value:</label>
                <input type="number" id="inventoryValue" placeholder="Enter inventory value" min="0">
                
                <label>Business Bank Balance:</label>
                <input type="number" id="businessBank" placeholder="Enter business account balance" min="0">
                
                <label>Accounts Receivable:</label>
                <input type="number" id="accountsReceivable" placeholder="Enter receivables amount" min="0">
            </div>

            <!-- Investments Section -->
            <div id="investments-section" class="input-group">
                <label>Stocks Portfolio Value:</label>
                <input type="number" id="stocksValue" placeholder="Enter total stocks value" min="0">
                
                <label>Mutual Funds Value:</label>
                <input type="number" id="mutualFundsValue" placeholder="Enter mutual funds value" min="0">
                
                <label>Cryptocurrency Value:</label>
                <input type="number" id="cryptoValue" placeholder="Enter cryptocurrency value" min="0">
            </div>

            <!-- Property Section -->
            <div id="property-section" class="input-group">
                <label>Annual Rental Income:</label>
                <input type="number" id="rentalIncome" placeholder="Enter annual rental income" min="0">
                
                <label>Rental Property Value:</label>
                <input type="number" id="propertyValue" placeholder="Enter property value" min="0">
                
                <label>Outstanding Rental Payments:</label>
                <input type="number" id="outstandingRent" placeholder="Enter outstanding rent" min="0">
            </div>
        </div>

        <button class="calculate-btn" onclick="calculateZakat()">
            Calculate Zakat
        </button>

        <div id="result" class="result-card" style="display: none;">
            <!-- Results will be populated here -->
        </div>
    </div>

    <script>
        let goldPrice = 0;
        let silverPrice = 0;
        let currencyRate = 1;
        let selectedCurrency = "USD";

        // Add theme switching functionality
        function setTheme(theme) {
            document.body.setAttribute('data-theme', theme);
            localStorage.setItem('preferred-theme', theme);
        }

        // Load saved theme
        document.addEventListener('DOMContentLoaded', () => {
            const savedTheme = localStorage.getItem('preferred-theme') || 'default';
            setTheme(savedTheme);
            
            // Initialize by hiding all sections except cash
            const sections = ['gold-section', 'business-section', 'investments-section', 'property-section'];
            sections.forEach(section => {
                document.getElementById(section).style.display = 'none';
            });
            fetchGoldSilverRates();
        });

        function showSection(sectionName) {
            const sections = {
                'cash': 'cash-section',
                'gold': 'gold-section',
                'business': 'business-section',
                'investments': 'investments-section',
                'property': 'property-section'
            };

            // Hide all sections first
            Object.values(sections).forEach(section => {
                document.getElementById(section).style.display = 'none';
            });

            // Show the selected section
            if (sections[sectionName]) {
                document.getElementById(sections[sectionName]).style.display = 'block';
            }
        }

        async function fetchGoldSilverRates() {
            selectedCurrency = document.getElementById("currency").value.toLowerCase();
            try {
                // First fetch exchange rates for all currencies
                const exchangeResponse = await fetch(`https://api.exchangerate-api.com/v4/latest/USD`);
                const exchangeData = await exchangeResponse.json();
                
                if (!exchangeData.rates) {
                    throw new Error("Failed to fetch exchange rates");
                }

                // Store the exchange rate for selected currency
                currencyRate = exchangeData.rates[selectedCurrency.toUpperCase()] || 1;

                // Fetch gold and silver prices from Metal Price API
                const metalResponse = await fetch('https://api.metals.live/v1/spot');
                const metalData = await metalResponse.json();
                
                // The API returns prices in USD per ounce, convert to grams
                const goldOuncePrice = metalData.find(metal => metal.gold)?.gold || 1935;
                const silverOuncePrice = metalData.find(metal => metal.silver)?.silver || 23;
                
                // Convert troy ounce prices to gram prices and apply currency conversion
                goldPrice = (goldOuncePrice / 31.1035) * currencyRate;
                silverPrice = (silverOuncePrice / 31.1035) * currencyRate;

                // Get currency symbol
                const currencySymbols = {
                    usd: '$', eur: '€', gbp: '£', pkr: '₨', aed: 'د.إ', aud: '$', 
                    bdt: '৳', bhd: '.د.ب', cad: '$', chf: 'Fr', cny: '¥', egp: '£',
                    idr: 'Rp', inr: '₹', jod: 'د.ا', jpy: '¥', kwd: 'د.ك', lkr: '₨',
                    mad: 'د.م.', myr: 'RM', ngn: '₦', omr: 'ر.ع.', qar: 'ر.ق', 
                    sar: 'ر.س', sgd: '$', try: '₺', zar: 'R'
                };
                const currencySymbol = currencySymbols[selectedCurrency] || selectedCurrency.toUpperCase();

                // Update the display with current prices
                document.getElementById("goldRate").innerHTML = `${currencySymbol} ${goldPrice.toFixed(2)}/g`;
                document.getElementById("silverRate").innerHTML = `${currencySymbol} ${silverPrice.toFixed(2)}/g`;

            } catch (error) {
                console.error("Error fetching rates:", error);
                
                // Use hardcoded fallback prices if API fails
                try {
                    // Default prices in USD per gram (based on recent market averages)
                    goldPrice = 62.23;  // Approximately $1935 per oz
                    silverPrice = 0.74;  // Approximately $23 per oz
                    
                    // Convert to selected currency
                    goldPrice *= currencyRate;
                    silverPrice *= currencyRate;

                    const currencySymbols = {
                        usd: '$', eur: '€', gbp: '£', pkr: '₨', aed: 'د.إ', aud: '$', 
                        bdt: '৳', bhd: '.د.ب', cad: '$', chf: 'Fr', cny: '¥', egp: '£',
                        idr: 'Rp', inr: '₹', jod: 'د.ا', jpy: '¥', kwd: 'د.ك', lkr: '₨',
                        mad: 'د.م.', myr: 'RM', ngn: '₦', omr: 'ر.ع.', qar: 'ر.ق', 
                        sar: 'ر.س', sgd: '$', try: '₺', zar: 'R'
                    };
                    const currencySymbol = currencySymbols[selectedCurrency] || selectedCurrency.toUpperCase();
                    
                    document.getElementById("goldRate").innerHTML = `${currencySymbol} ${goldPrice.toFixed(2)}/g (Est.)`;
                    document.getElementById("silverRate").innerHTML = `${currencySymbol} ${silverPrice.toFixed(2)}/g (Est.)`;
                    
                } catch (fallbackError) {
                    console.error("Even fallback mechanism failed:", fallbackError);
                    document.getElementById("goldRate").innerHTML = `Error fetching rates`;
                    document.getElementById("silverRate").innerHTML = `Error fetching rates`;
                }
            }
        }

        function convertWeight(weight, unit) {
            const conversion = {
                grams: 1,
                tola: 11.664,
                oz: 31.1035,
                lbs: 453.592
            };
            return weight * conversion[unit];
        }

        function calculateZakat() {
            // Get basic assets
            let cash = parseFloat(document.getElementById("cash").value) || 0;
            let goldWeight = parseFloat(document.getElementById("goldWeight").value) || 0;
            let goldUnit = document.getElementById("goldUnit").value;
            let silverWeight = parseFloat(document.getElementById("silverWeight").value) || 0;
            let silverUnit = document.getElementById("silverUnit").value;

            // Get business assets
            let inventoryValue = parseFloat(document.getElementById("inventoryValue").value) || 0;
            let businessBank = parseFloat(document.getElementById("businessBank").value) || 0;
            let accountsReceivable = parseFloat(document.getElementById("accountsReceivable").value) || 0;

            // Get rental income and property
            let rentalIncome = parseFloat(document.getElementById("rentalIncome").value) || 0;
            let propertyValue = parseFloat(document.getElementById("propertyValue").value) || 0;
            let outstandingRent = parseFloat(document.getElementById("outstandingRent").value) || 0;

            // Get investment values
            let stocksValue = parseFloat(document.getElementById("stocksValue").value) || 0;
            let mutualFundsValue = parseFloat(document.getElementById("mutualFundsValue").value) || 0;
            let cryptoValue = parseFloat(document.getElementById("cryptoValue").value) || 0;

            // Calculate precious metals value
            let goldValue = convertWeight(goldWeight, goldUnit) * goldPrice;
            let silverValue = convertWeight(silverWeight, silverUnit) * silverPrice;

            // Calculate total business assets
            let totalBusinessAssets = inventoryValue + businessBank + accountsReceivable;

            // Calculate total rental assets (annual income is divided by 12 to get monthly value)
            let totalRentalAssets = (rentalIncome / 12) + outstandingRent;

            // Calculate total investments
            let totalInvestments = stocksValue + mutualFundsValue + cryptoValue;

            // Calculate total wealth
            let totalWealth = (
                cash + 
                goldValue + 
                silverValue + 
                totalBusinessAssets + 
                totalRentalAssets + 
                totalInvestments
            );

            // Calculate both Nisab thresholds
            let goldNisabThreshold = 85 * goldPrice;  // 85g of gold
            let silverNisabThreshold = 595 * silverPrice;  // 595g of silver

            // Get selected Nisab standard
            let selectedNisabStandard = document.getElementById("nisabStandard").value;
            let nisabThreshold = selectedNisabStandard === 'gold' ? goldNisabThreshold : silverNisabThreshold;

            // Get currency symbol
            const currencySymbols = {
                usd: '$', eur: '€', gbp: '£', pkr: '₨', aed: 'د.إ', aud: '$', 
                bdt: '৳', bhd: '.د.ب', cad: '$', chf: 'Fr', cny: '¥', egp: '£',
                idr: 'Rp', inr: '₹', jod: 'د.ا', jpy: '¥', kwd: 'د.ك', lkr: '₨',
                mad: 'د.م.', myr: 'RM', ngn: '₦', omr: 'ر.ع.', qar: 'ر.ق', 
                sar: 'ر.س', sgd: '$', try: '₺', zar: 'R'
            };
            const currencySymbol = currencySymbols[selectedCurrency] || selectedCurrency.toUpperCase();

            // Format currency values
            function formatCurrency(amount) {
                return `${currencySymbol} ${amount.toFixed(2)}`;
            }

            // Create detailed breakdown
            let resultHTML = `
                <div class="result-header">
                    <h3>Your Zakat Results</h3>
                    <div class="calculation-time">Calculated on ${new Date().toLocaleString()}</div>
                </div>

                <div class="breakdown-item">
                    <span class="breakdown-label">Cash & Bank Balance</span>
                    <span class="breakdown-value">${formatCurrency(cash)}</span>
                </div>
                <div class="breakdown-item">
                    <span class="breakdown-label">Gold Value</span>
                    <span class="breakdown-value">${formatCurrency(goldValue)}</span>
                </div>
                <div class="breakdown-item">
                    <span class="breakdown-label">Silver Value</span>
                    <span class="breakdown-value">${formatCurrency(silverValue)}</span>
                </div>
                <div class="breakdown-item">
                    <span class="breakdown-label">Business Assets</span>
                    <span class="breakdown-value">${formatCurrency(totalBusinessAssets)}</span>
                </div>
                <div class="breakdown-item">
                    <span class="breakdown-label">Rental Assets</span>
                    <span class="breakdown-value">${formatCurrency(totalRentalAssets)}</span>
                </div>
                <div class="breakdown-item">
                    <span class="breakdown-label">Investments</span>
                    <span class="breakdown-value">${formatCurrency(totalInvestments)}</span>
                </div>

                <hr>

                <div class="breakdown-item">
                    <span class="breakdown-label">Total Wealth</span>
                    <span class="breakdown-value">${formatCurrency(totalWealth)}</span>
                </div>
                <div class="breakdown-item">
                    <span class="breakdown-label">Nisab Threshold (${selectedNisabStandard})</span>
                    <span class="breakdown-value">${formatCurrency(nisabThreshold)}</span>
                </div>
            `;

            if (totalWealth >= nisabThreshold) {
                let zakatDue = totalWealth * 0.025;
                resultHTML += `
                    <div class="total-zakat">
                        Zakat Due: ${formatCurrency(zakatDue)}
                    </div>
                    <small style="color: #666; text-align: center; display: block;">
                        (2.5% of total wealth)
                    </small>
                `;
            } else {
                resultHTML += `
                    <div style="color: #e74c3c; text-align: center; margin-top: 20px;">
                        <strong>Zakat Not Due</strong><br>
                        <small>Total wealth is below the Nisab threshold</small>
                    </div>
                `;
            }

            document.getElementById("result").innerHTML = resultHTML;
            document.getElementById("result").style.display = "block";
        }

        // Add touch event handling for mobile
        document.addEventListener('touchstart', function() {}, {passive: true});
        
        // Prevent double-tap zoom on iOS
        document.addEventListener('dblclick', function(e) {
            e.preventDefault();
        }, { passive: false });
        
        // Prevent elastic scrolling on iOS
        document.body.addEventListener('touchmove', function(e) {
            if (e.target.closest('.input-group, .result-card')) return;
            e.preventDefault();
        }, { passive: false });
        
        // Add platform detection
        function detectPlatform() {
            const ua = navigator.userAgent.toLowerCase();
            if (ua.includes('android')) return 'android';
            if (ua.includes('iphone') || ua.includes('ipad') || ua.includes('ipod')) return 'ios';
            return 'desktop';
        }
        
        // Adjust UI based on platform
        document.addEventListener('DOMContentLoaded', () => {
            const platform = detectPlatform();
            document.body.setAttribute('data-platform', platform);
            
            // Load saved theme
            const savedTheme = localStorage.getItem('preferred-theme') || 'default';
            setTheme(savedTheme);
            
            // Initialize sections
            const sections = ['gold-section', 'business-section', 'investments-section', 'property-section'];
            sections.forEach(section => {
                document.getElementById(section).style.display = 'none';
            });
            
            // Initial rates fetch
            fetchGoldSilverRates();
            
            // Add active states for touch devices
            if (platform === 'ios' || platform === 'android') {
                document.querySelectorAll('.category-card, .calculate-btn').forEach(el => {
                    el.addEventListener('touchstart', function() {
                        this.style.transform = 'scale(0.98)';
                    }, { passive: true });
                    
                    el.addEventListener('touchend', function() {
                        this.style.transform = '';
                    }, { passive: true });
                });
            }
        });
    </script>
</body>
</html>


