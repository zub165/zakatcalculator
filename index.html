<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Zakat Calculator</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        :root {
            --primary-color: #27ae60;
            --secondary-color: #2ecc71;
            --background-color: #f8f9fa;
            --text-color: #2c3e50;
            --border-color: #e0e0e0;
            --card-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--background-color);
            color: var(--text-color);
            line-height: 1.6;
        }

        .container {
            max-width: 600px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            display: flex;
            align-items: center;
            margin-bottom: 30px;
            padding: 15px 0;
        }

        .back-button {
            background: none;
            border: none;
            font-size: 24px;
            color: var(--text-color);
            cursor: pointer;
            margin-right: 15px;
        }

        .title {
            font-size: 24px;
            font-weight: 600;
            color: var(--text-color);
        }

        .card-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .category-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            box-shadow: var(--card-shadow);
            cursor: pointer;
            transition: transform 0.2s;
        }

        .category-card:hover {
            transform: translateY(-2px);
        }

        .category-icon {
            width: 48px;
            height: 48px;
            margin-bottom: 12px;
            color: var(--primary-color);
        }

        .category-name {
            font-size: 14px;
            font-weight: 500;
        }

        .input-group {
            background: white;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: var(--card-shadow);
        }

        .input-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--text-color);
        }

        .input-group input,
        .input-group select {
            width: 100%;
            padding: 12px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            font-size: 16px;
            margin-bottom: 15px;
        }

        .input-group input:focus,
        .input-group select:focus {
            outline: none;
            border-color: var(--primary-color);
        }

        .rates-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: var(--card-shadow);
        }

        .rate-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid var(--border-color);
        }

        .rate-item:last-child {
            border-bottom: none;
        }

        .rate-label {
            font-weight: 500;
        }

        .rate-value {
            color: var(--primary-color);
            font-weight: 600;
        }

        .button {
            background: var(--primary-color);
            color: white;
            border: none;
            padding: 15px;
            width: 100%;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .button:hover {
            background: var(--secondary-color);
        }

        .result-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            margin-top: 20px;
            box-shadow: var(--card-shadow);
            display: none;
        }

        .result-header {
            text-align: center;
            margin-bottom: 20px;
        }

        .total-zakat {
            font-size: 32px;
            font-weight: 600;
            color: var(--primary-color);
            margin: 10px 0;
        }

        .calculation-time {
            color: #666;
            font-size: 14px;
        }

        .breakdown-item {
            display: flex;
            justify-content: space-between;
            padding: 12px 0;
            border-bottom: 1px solid var(--border-color);
        }

        .breakdown-item:last-child {
            border-bottom: none;
        }

        .breakdown-label {
            font-weight: 500;
        }

        .breakdown-value {
            font-weight: 600;
        }

        .dark-mode {
            background-color: #1a1a1a;
            color: #ffffff;
        }

        .dark-mode .card-grid,
        .dark-mode .input-group,
        .dark-mode .rates-card,
        .dark-mode .result-card {
            background-color: #2d2d2d;
        }

        .dark-mode input,
        .dark-mode select {
            background-color: #1a1a1a;
            color: #ffffff;
            border-color: #3d3d3d;
        }

        .toggle-dark-mode {
            position: absolute;
            top: 20px;
            right: 20px;
            background: none;
            border: none;
            font-size: 24px;
            color: var(--primary-color);
            cursor: pointer;
        }

        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }

            .card-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .title {
                font-size: 20px;
            }
        }
    </style>
</head>
<body>
    <button class="toggle-dark-mode" onclick="toggleDarkMode()">üåô</button>

    <div class="container">
        <div class="header">
            <button class="back-button">‚Üê</button>
            <h1 class="title">Calculate your Zakat</h1>
        </div>

        <div class="card-grid">
            <div class="category-card" onclick="showSection('cash')">
                <i class="fas fa-money-bill-wave category-icon"></i>
                <div class="category-name">Cash in Hand</div>
            </div>
            <div class="category-card" onclick="showSection('gold')">
                <i class="fas fa-coins category-icon"></i>
                <div class="category-name">Gold & Silver</div>
            </div>
            <div class="category-card" onclick="showSection('business')">
                <i class="fas fa-store category-icon"></i>
                <div class="category-name">Business Assets</div>
            </div>
            <div class="category-card" onclick="showSection('investments')">
                <i class="fas fa-chart-line category-icon"></i>
                <div class="category-name">Investments</div>
            </div>
            <div class="category-card" onclick="showSection('property')">
                <i class="fas fa-home category-icon"></i>
                <div class="category-name">Property</div>
            </div>
            <div class="category-card" onclick="showSection('other')">
                <i class="fas fa-plus category-icon"></i>
                <div class="category-name">Other Assets</div>
            </div>
        </div>

        <div class="input-group">
            <label>Select Currency:</label>
            <select id="currency" onchange="fetchGoldSilverRates()">
                <option value="USD">USD ($) - US Dollar</option>
                <option value="AED">AED (ÿØ.ÿ•) - UAE Dirham</option>
                <option value="AUD">AUD ($) - Australian Dollar</option>
                <option value="BDT">BDT (‡ß≥) - Bangladeshi Taka</option>
                <option value="BHD">BHD (.ÿØ.ÿ®) - Bahraini Dinar</option>
                <option value="CAD">CAD ($) - Canadian Dollar</option>
                <option value="CHF">CHF (Fr) - Swiss Franc</option>
                <option value="CNY">CNY (¬•) - Chinese Yuan</option>
                <option value="EGP">EGP (¬£) - Egyptian Pound</option>
                <option value="EUR">EUR (‚Ç¨) - Euro</option>
                <option value="GBP">GBP (¬£) - British Pound</option>
                <option value="IDR">IDR (Rp) - Indonesian Rupiah</option>
                <option value="INR">INR (‚Çπ) - Indian Rupee</option>
                <option value="JOD">JOD (ÿØ.ÿß) - Jordanian Dinar</option>
                <option value="JPY">JPY (¬•) - Japanese Yen</option>
                <option value="KWD">KWD (ÿØ.ŸÉ) - Kuwaiti Dinar</option>
                <option value="LKR">LKR (‚Ç®) - Sri Lankan Rupee</option>
                <option value="MAD">MAD (ÿØ.ŸÖ.) - Moroccan Dirham</option>
                <option value="MYR">MYR (RM) - Malaysian Ringgit</option>
                <option value="NGN">NGN (‚Ç¶) - Nigerian Naira</option>
                <option value="OMR">OMR (ÿ±.ÿπ.) - Omani Rial</option>
                <option value="PKR">PKR (‚Ç®) - Pakistani Rupee</option>
                <option value="QAR">QAR (ÿ±.ŸÇ) - Qatari Riyal</option>
                <option value="SAR">SAR (ÿ±.ÿ≥) - Saudi Riyal</option>
                <option value="SGD">SGD ($) - Singapore Dollar</option>
                <option value="TRY">TRY (‚Ç∫) - Turkish Lira</option>
                <option value="ZAR">ZAR (R) - South African Rand</option>
            </select>

            <label>Select Nisab Standard:</label>
            <select id="nisabStandard">
                <option value="gold">Gold Standard (85g)</option>
                <option value="silver" selected>Silver Standard (595g) - Recommended</option>
            </select>
        </div>

        <div class="rates-card">
            <div class="rate-item">
                <span class="rate-label">Gold Rate</span>
                <span id="goldRate" class="rate-value">Fetching...</span>
            </div>
            <div class="rate-item">
                <span class="rate-label">Silver Rate</span>
                <span id="silverRate" class="rate-value">Fetching...</span>
            </div>
        </div>

        <div id="sections">
            <!-- Cash Section -->
            <div id="cash-section" class="input-group">
                <label>Cash & Bank Balance:</label>
                <input type="number" id="cash" placeholder="Enter amount" min="0">
            </div>

            <!-- Gold & Silver Section -->
            <div id="gold-section" class="input-group">
                <label>Gold Weight:</label>
                <input type="number" id="goldWeight" placeholder="Enter weight" min="0">
                <select id="goldUnit">
                    <option value="grams">Grams</option>
                    <option value="tola">Tolas</option>
                    <option value="oz">Ounces</option>
                    <option value="lbs">Pounds</option>
                </select>

                <label>Silver Weight:</label>
                <input type="number" id="silverWeight" placeholder="Enter weight" min="0">
                <select id="silverUnit">
                    <option value="grams">Grams</option>
                    <option value="tola">Tolas</option>
                    <option value="oz">Ounces</option>
                    <option value="lbs">Pounds</option>
                </select>
            </div>

            <!-- Business Assets Section -->
            <div id="business-section" class="input-group">
                <label>Business Inventory Value:</label>
                <input type="number" id="inventoryValue" placeholder="Enter inventory value" min="0">
                
                <label>Business Bank Balance:</label>
                <input type="number" id="businessBank" placeholder="Enter business account balance" min="0">
                
                <label>Accounts Receivable:</label>
                <input type="number" id="accountsReceivable" placeholder="Enter receivables amount" min="0">
            </div>

            <!-- Investments Section -->
            <div id="investments-section" class="input-group">
                <label>Stocks Portfolio Value:</label>
                <input type="number" id="stocksValue" placeholder="Enter total stocks value" min="0">
                
                <label>Mutual Funds Value:</label>
                <input type="number" id="mutualFundsValue" placeholder="Enter mutual funds value" min="0">
                
                <label>Cryptocurrency Value:</label>
                <input type="number" id="cryptoValue" placeholder="Enter cryptocurrency value" min="0">
            </div>

            <!-- Property Section -->
            <div id="property-section" class="input-group">
                <label>Annual Rental Income:</label>
                <input type="number" id="rentalIncome" placeholder="Enter annual rental income" min="0">
                
                <label>Rental Property Value:</label>
                <input type="number" id="propertyValue" placeholder="Enter property value" min="0">
                
                <label>Outstanding Rental Payments:</label>
                <input type="number" id="outstandingRent" placeholder="Enter outstanding rent" min="0">
            </div>
        </div>

        <button class="button" onclick="calculateZakat()">Calculate Zakat</button>

        <div id="result" class="result-card">
            <!-- Results will be populated here -->
        </div>
    </div>

    <script>
        let goldPrice = 0;
        let silverPrice = 0;
        let currencyRate = 1;
        let selectedCurrency = "USD";

        // Initialize by hiding all sections except cash
        document.addEventListener('DOMContentLoaded', function() {
            const sections = ['gold-section', 'business-section', 'investments-section', 'property-section'];
            sections.forEach(section => {
                document.getElementById(section).style.display = 'none';
            });
            fetchGoldSilverRates();
        });

        function showSection(sectionName) {
            const sections = {
                'cash': 'cash-section',
                'gold': 'gold-section',
                'business': 'business-section',
                'investments': 'investments-section',
                'property': 'property-section'
            };

            // Hide all sections first
            Object.values(sections).forEach(section => {
                document.getElementById(section).style.display = 'none';
            });

            // Show the selected section
            if (sections[sectionName]) {
                document.getElementById(sections[sectionName]).style.display = 'block';
            }
        }

        async function fetchGoldSilverRates() {
            selectedCurrency = document.getElementById("currency").value.toLowerCase();
            try {
                // First fetch exchange rates for all currencies
                const exchangeResponse = await fetch(`https://api.exchangerate-api.com/v4/latest/USD`);
                const exchangeData = await exchangeResponse.json();
                
                if (!exchangeData.rates) {
                    throw new Error("Failed to fetch exchange rates");
                }

                // Store the exchange rate for selected currency
                currencyRate = exchangeData.rates[selectedCurrency.toUpperCase()] || 1;

                // Fetch gold and silver prices from Metal Price API
                const metalResponse = await fetch('https://api.metals.live/v1/spot');
                const metalData = await metalResponse.json();
                
                // The API returns prices in USD per ounce, convert to grams
                const goldOuncePrice = metalData.find(metal => metal.gold)?.gold || 1935;
                const silverOuncePrice = metalData.find(metal => metal.silver)?.silver || 23;
                
                // Convert troy ounce prices to gram prices and apply currency conversion
                goldPrice = (goldOuncePrice / 31.1035) * currencyRate;
                silverPrice = (silverOuncePrice / 31.1035) * currencyRate;

                // Get currency symbol
                const currencySymbols = {
                    usd: '$', eur: '‚Ç¨', gbp: '¬£', pkr: '‚Ç®', aed: 'ÿØ.ÿ•', aud: '$', 
                    bdt: '‡ß≥', bhd: '.ÿØ.ÿ®', cad: '$', chf: 'Fr', cny: '¬•', egp: '¬£',
                    idr: 'Rp', inr: '‚Çπ', jod: 'ÿØ.ÿß', jpy: '¬•', kwd: 'ÿØ.ŸÉ', lkr: '‚Ç®',
                    mad: 'ÿØ.ŸÖ.', myr: 'RM', ngn: '‚Ç¶', omr: 'ÿ±.ÿπ.', qar: 'ÿ±.ŸÇ', 
                    sar: 'ÿ±.ÿ≥', sgd: '$', try: '‚Ç∫', zar: 'R'
                };
                const currencySymbol = currencySymbols[selectedCurrency] || selectedCurrency.toUpperCase();

                // Update the display with current prices
                document.getElementById("goldRate").innerHTML = `${currencySymbol} ${goldPrice.toFixed(2)}/g`;
                document.getElementById("silverRate").innerHTML = `${currencySymbol} ${silverPrice.toFixed(2)}/g`;

            } catch (error) {
                console.error("Error fetching rates:", error);
                
                // Use hardcoded fallback prices if API fails
                try {
                    // Default prices in USD per gram (based on recent market averages)
                    goldPrice = 62.23;  // Approximately $1935 per oz
                    silverPrice = 0.74;  // Approximately $23 per oz
                    
                    // Convert to selected currency
                    goldPrice *= currencyRate;
                    silverPrice *= currencyRate;

                    const currencySymbols = {
                        usd: '$', eur: '‚Ç¨', gbp: '¬£', pkr: '‚Ç®', aed: 'ÿØ.ÿ•', aud: '$', 
                        bdt: '‡ß≥', bhd: '.ÿØ.ÿ®', cad: '$', chf: 'Fr', cny: '¬•', egp: '¬£',
                        idr: 'Rp', inr: '‚Çπ', jod: 'ÿØ.ÿß', jpy: '¬•', kwd: 'ÿØ.ŸÉ', lkr: '‚Ç®',
                        mad: 'ÿØ.ŸÖ.', myr: 'RM', ngn: '‚Ç¶', omr: 'ÿ±.ÿπ.', qar: 'ÿ±.ŸÇ', 
                        sar: 'ÿ±.ÿ≥', sgd: '$', try: '‚Ç∫', zar: 'R'
                    };
                    const currencySymbol = currencySymbols[selectedCurrency] || selectedCurrency.toUpperCase();
                    
                    document.getElementById("goldRate").innerHTML = `${currencySymbol} ${goldPrice.toFixed(2)}/g (Est.)`;
                    document.getElementById("silverRate").innerHTML = `${currencySymbol} ${silverPrice.toFixed(2)}/g (Est.)`;
                    
                } catch (fallbackError) {
                    console.error("Even fallback mechanism failed:", fallbackError);
                    document.getElementById("goldRate").innerHTML = `Error fetching rates`;
                    document.getElementById("silverRate").innerHTML = `Error fetching rates`;
                }
            }
        }

        function convertWeight(weight, unit) {
            const conversion = {
                grams: 1,
                tola: 11.664,
                oz: 31.1035,
                lbs: 453.592
            };
            return weight * conversion[unit];
        }

        function calculateZakat() {
            // Get basic assets
            let cash = parseFloat(document.getElementById("cash").value) || 0;
            let goldWeight = parseFloat(document.getElementById("goldWeight").value) || 0;
            let goldUnit = document.getElementById("goldUnit").value;
            let silverWeight = parseFloat(document.getElementById("silverWeight").value) || 0;
            let silverUnit = document.getElementById("silverUnit").value;

            // Get business assets
            let inventoryValue = parseFloat(document.getElementById("inventoryValue").value) || 0;
            let businessBank = parseFloat(document.getElementById("businessBank").value) || 0;
            let accountsReceivable = parseFloat(document.getElementById("accountsReceivable").value) || 0;

            // Get rental income and property
            let rentalIncome = parseFloat(document.getElementById("rentalIncome").value) || 0;
            let propertyValue = parseFloat(document.getElementById("propertyValue").value) || 0;
            let outstandingRent = parseFloat(document.getElementById("outstandingRent").value) || 0;

            // Get investment values
            let stocksValue = parseFloat(document.getElementById("stocksValue").value) || 0;
            let mutualFundsValue = parseFloat(document.getElementById("mutualFundsValue").value) || 0;
            let cryptoValue = parseFloat(document.getElementById("cryptoValue").value) || 0;

            // Calculate precious metals value
            let goldValue = convertWeight(goldWeight, goldUnit) * goldPrice;
            let silverValue = convertWeight(silverWeight, silverUnit) * silverPrice;

            // Calculate total business assets
            let totalBusinessAssets = inventoryValue + businessBank + accountsReceivable;

            // Calculate total rental assets (annual income is divided by 12 to get monthly value)
            let totalRentalAssets = (rentalIncome / 12) + outstandingRent;

            // Calculate total investments
            let totalInvestments = stocksValue + mutualFundsValue + cryptoValue;

            // Calculate total wealth
            let totalWealth = (
                cash + 
                goldValue + 
                silverValue + 
                totalBusinessAssets + 
                totalRentalAssets + 
                totalInvestments
            );

            // Calculate both Nisab thresholds
            let goldNisabThreshold = 85 * goldPrice;  // 85g of gold
            let silverNisabThreshold = 595 * silverPrice;  // 595g of silver

            // Get selected Nisab standard
            let selectedNisabStandard = document.getElementById("nisabStandard").value;
            let nisabThreshold = selectedNisabStandard === 'gold' ? goldNisabThreshold : silverNisabThreshold;

            // Get currency symbol
            const currencySymbols = {
                usd: '$', eur: '‚Ç¨', gbp: '¬£', pkr: '‚Ç®', aed: 'ÿØ.ÿ•', aud: '$', 
                bdt: '‡ß≥', bhd: '.ÿØ.ÿ®', cad: '$', chf: 'Fr', cny: '¬•', egp: '¬£',
                idr: 'Rp', inr: '‚Çπ', jod: 'ÿØ.ÿß', jpy: '¬•', kwd: 'ÿØ.ŸÉ', lkr: '‚Ç®',
                mad: 'ÿØ.ŸÖ.', myr: 'RM', ngn: '‚Ç¶', omr: 'ÿ±.ÿπ.', qar: 'ÿ±.ŸÇ', 
                sar: 'ÿ±.ÿ≥', sgd: '$', try: '‚Ç∫', zar: 'R'
            };
            const currencySymbol = currencySymbols[selectedCurrency] || selectedCurrency.toUpperCase();

            // Format currency values
            function formatCurrency(amount) {
                return `${currencySymbol} ${amount.toFixed(2)}`;
            }

            // Create detailed breakdown
            let resultHTML = `
                <div class="result-header">
                    <h3>Your Zakat Results</h3>
                    <div class="calculation-time">Calculated on ${new Date().toLocaleString()}</div>
                </div>

                <div class="breakdown-item">
                    <span class="breakdown-label">Cash & Bank Balance</span>
                    <span class="breakdown-value">${formatCurrency(cash)}</span>
                </div>
                <div class="breakdown-item">
                    <span class="breakdown-label">Gold Value</span>
                    <span class="breakdown-value">${formatCurrency(goldValue)}</span>
                </div>
                <div class="breakdown-item">
                    <span class="breakdown-label">Silver Value</span>
                    <span class="breakdown-value">${formatCurrency(silverValue)}</span>
                </div>
                <div class="breakdown-item">
                    <span class="breakdown-label">Business Assets</span>
                    <span class="breakdown-value">${formatCurrency(totalBusinessAssets)}</span>
                </div>
                <div class="breakdown-item">
                    <span class="breakdown-label">Rental Assets</span>
                    <span class="breakdown-value">${formatCurrency(totalRentalAssets)}</span>
                </div>
                <div class="breakdown-item">
                    <span class="breakdown-label">Investments</span>
                    <span class="breakdown-value">${formatCurrency(totalInvestments)}</span>
                </div>

                <hr>

                <div class="breakdown-item">
                    <span class="breakdown-label">Total Wealth</span>
                    <span class="breakdown-value">${formatCurrency(totalWealth)}</span>
                </div>
                <div class="breakdown-item">
                    <span class="breakdown-label">Nisab Threshold (${selectedNisabStandard})</span>
                    <span class="breakdown-value">${formatCurrency(nisabThreshold)}</span>
                </div>
            `;

            if (totalWealth >= nisabThreshold) {
                let zakatDue = totalWealth * 0.025;
                resultHTML += `
                    <div class="total-zakat">
                        Zakat Due: ${formatCurrency(zakatDue)}
                    </div>
                    <small style="color: #666; text-align: center; display: block;">
                        (2.5% of total wealth)
                    </small>
                `;
            } else {
                resultHTML += `
                    <div style="color: #e74c3c; text-align: center; margin-top: 20px;">
                        <strong>Zakat Not Due</strong><br>
                        <small>Total wealth is below the Nisab threshold</small>
                    </div>
                `;
            }

            document.getElementById("result").innerHTML = resultHTML;
            document.getElementById("result").style.display = "block";
        }

        function toggleDarkMode() {
            document.body.classList.toggle("dark-mode");
            const button = document.querySelector(".toggle-dark-mode");
            button.innerHTML = document.body.classList.contains("dark-mode") ? "‚òÄÔ∏è" : "üåô";
        }
    </script>
</body>
</html>

